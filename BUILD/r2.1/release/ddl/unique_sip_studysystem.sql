--Sequence for Unique SIP Study/Site ID
CREATE SEQUENCE SEQ_SIPSTUDYSYSTEMID MINVALUE 1 MAXVALUE 9999 START WITH 1 INCREMENT BY 1 NOCACHE;


--Add New Column for Unique SIP STUDYSYSTEM ID
ALTER TABLE TBL_STUDYSYSTEMMAP 
ADD(SIPSTUDYSYSTEMID VARCHAR2(20 CHAR));

COMMENT ON COLUMN TBL_STUDYSYSTEMMAP.SIPSTUDYSYSTEMID IS 'SIP Unique Study System ID';

--Update Unique SIP ID for existing records
BEGIN

  FOR i IN (SELECT STUDYSYSTEMID FROM TBL_STUDYSYSTEMMAP ORDER BY STUDYSYSTEMID) LOOP
  
      UPDATE TBL_STUDYSYSTEMMAP
      SET SIPSTUDYSYSTEMID = 'SS' || TO_CHAR(CREATEDDT,'MMDDYYYYHH24MISS') || LPAD(SEQ_SIPSTUDYSYSTEMID.NEXTVAL,4,0) 
      WHERE STUDYSYSTEMID = i.STUDYSYSTEMID;              
  
      COMMIT;
  
  END LOOP;
  
END;
/

--Make SIP STUDYSYSTEM ID as NOT NULL
ALTER TABLE TBL_STUDYSYSTEMMAP
MODIFY(SIPSTUDYSYSTEMID VARCHAR2(20 CHAR) NOT NULL);	