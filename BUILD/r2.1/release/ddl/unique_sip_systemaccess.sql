--Sequence for Unique SIP tbl_orgsystemaccess
CREATE SEQUENCE SEQ_SIPSYSTEMACCESSID MINVALUE 1 MAXVALUE 9999 START WITH 1 INCREMENT BY 1 NOCACHE;


--Add New Column for Unique SIP STUDYSYSTEM ID
ALTER TABLE TBL_ORGSYSTEMACCESS
ADD(SIPSYSTEMACCESSID VARCHAR2(30 CHAR));

COMMENT ON COLUMN TBL_ORGSYSTEMACCESS.SIPSYSTEMACCESSID IS 'SIP Unique Study System Access ID';

--Update Unique SIP ID for existing records
BEGIN

  FOR i IN (SELECT ORGSYSTEMID FROM TBL_ORGSYSTEMACCESS ORDER BY ORGSYSTEMID) LOOP
  
      UPDATE TBL_ORGSYSTEMACCESS
      SET SIPSYSTEMACCESSID = 'SA' || TO_CHAR(CREATEDDT,'MMDDYYYYHH24MISS') || LPAD(SEQ_SIPSYSTEMACCESSID.NEXTVAL,4,0) 
      WHERE ORGSYSTEMID = i.ORGSYSTEMID;              
  
      COMMIT;
  
  END LOOP;
  
END;
/

--Make SIP TBL_ORGSYSTEMACCESS ID as NOT NULL
ALTER TABLE TBL_ORGSYSTEMACCESS
MODIFY(SIPSYSTEMACCESSID VARCHAR2(30 CHAR) NOT NULL);	