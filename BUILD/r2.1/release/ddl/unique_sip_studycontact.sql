--Sequence for Unique SIP Study Contact
CREATE SEQUENCE SEQ_SIPSTUDYCONTACTID MINVALUE 1 MAXVALUE 9999 START WITH 1 INCREMENT BY 1 NOCACHE;


--Add New Column for Unique SIP STUDYCONTACT ID
ALTER TABLE TBL_STUDYCONTACT 
ADD(SIPSTUDYCONTACTID VARCHAR2(30 CHAR));

COMMENT ON COLUMN TBL_STUDYCONTACT.SIPSTUDYCONTACTID IS 'SIP Unique Study Contact ID';

--Update Unique SIP ID for existing records
BEGIN

  FOR i IN (SELECT STUDYCONTACTID FROM TBL_STUDYCONTACT ORDER BY STUDYCONTACTID) LOOP
  
      UPDATE TBL_STUDYCONTACT
      SET SIPSTUDYCONTACTID = 'SC' || TO_CHAR(CREATEDDT,'MMDDYYYYHH24MISS') || LPAD(SEQ_SIPSTUDYCONTACTID.NEXTVAL,4,0) 
      WHERE STUDYCONTACTID = i.STUDYCONTACTID;              
  
      COMMIT;
  
  END LOOP;
  
END;
/

--Make SIP STUDYCONTACT ID as NOT NULL
ALTER TABLE TBL_STUDYCONTACT
MODIFY(SIPSTUDYCONTACTID VARCHAR2(30 CHAR) NOT NULL);	