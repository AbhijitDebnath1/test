--Sequence for Unique TBL_FACILITIES
CREATE SEQUENCE SEQ_SIPFACILITYID MINVALUE 1 MAXVALUE 9999 START WITH 1 INCREMENT BY 1 NOCACHE;


--Add New Column for Unique SIP FACILITIES ID
ALTER TABLE TBL_FACILITIES 
ADD(SIPFACILITYID VARCHAR2(20 CHAR));

COMMENT ON COLUMN TBL_FACILITIES.SIPFACILITYID IS 'SIP Unique Facility ID';

--Update Unique SIP ID for existing records
BEGIN

  FOR i IN (SELECT FACILITYID FROM TBL_FACILITIES ORDER BY FACILITYID) LOOP
  
      UPDATE TBL_FACILITIES
      SET SIPFACILITYID = 'FC' || TO_CHAR(CREATEDDT,'MMDDYYYYHH24MISS') || LPAD(SEQ_SIPFACILITYID.NEXTVAL,4,0) 
      WHERE FACILITYID = i.FACILITYID;              
  
      COMMIT;
  
  END LOOP;
  
END;
/

--Make SIP FACILITIES ID as NOT NULL
ALTER TABLE TBL_FACILITIES
MODIFY(SIPFACILITYID VARCHAR2(20 CHAR) NOT NULL);	