create or replace PACKAGE PKG_SEARCH AS

--Procedure for Searching Common Documents for Site/Sponsor User
PROCEDURE SP_SEARCH_COMMON_DOCUMENT
(
ip_loggedin_userid        IN TBL_USERPROFILES.userid%TYPE,
ip_search_type            IN VARCHAR2,
ip_documenttypeid         IN TBL_DOCTYPEMASTER.doctypeid%TYPE,
ip_filename               IN TBL_DOCUMENTS.title%TYPE,
ip_description            IN TBL_DOCUMENTS.description%TYPE,
ip_user_first_name        IN TBL_USERPROFILES.firstname%TYPE,
ip_user_last_name         IN TBL_USERPROFILES.lastname%TYPE,
ip_email                  IN TBL_CONTACT.email%TYPE,
ip_roleid                 IN TBL_ROLES.roleid%TYPE,       
ip_user_countryid         IN TBL_COUNTRIES.countryid%TYPE,
ip_user_stateid           IN TBL_STATES.stateid%TYPE,
ip_user_city              IN TBL_CONTACT.city%TYPE,
ip_facility_name          IN TBL_FACILITIES.facilityname%TYPE,
ip_department_name        IN TBL_FACILITIES.departmentname%TYPE,
ip_department_type_id     IN TBL_FACILITIES.departmenttypeid%TYPE,
ip_facdept_countryid      IN TBL_COUNTRIES.countryid%TYPE,
ip_facdept_stateid        IN TBL_STATES.stateid%TYPE,
ip_facdept_city           IN TBL_CONTACT.city%TYPE,
ip_gen_upload_from_date   IN TBL_DOCUMENTS.createddt%TYPE,
ip_gen_upload_to_date     IN TBL_DOCUMENTS.createddt%TYPE,
ip_offset                 IN NUMBER,
ip_limit                  IN NUMBER,
ip_ordrby                 IN VARCHAR2,
ip_sortby                 IN VARCHAR2,
op_count                  OUT NUMBER,
op_common_document        OUT SYS_REFCURSOR
);

--Procedure for Sponsor User Facility Search
 PROCEDURE SP_SPNSR_FAC_SEARCH(
      IP_LOGGEDINUSER   IN NUMBER,
      IP_COUNTRYCD      IN VARCHAR2,
      IP_STATECD        IN VARCHAR2,
      IP_CITY           IN VARCHAR2,
	  IP_FACNAME			IN VARCHAR2,
    IP_DEPTYPEID			IN NUM_ARRAY,
	  IP_THERAAREA		IN NUM_ARRAY,
	  IP_SUBTHERAREA		IN NUM_ARRAY,
    IP_FACPHID       IN NUM_ARRAY,
    IP_ISINDUSTRY    IN VARCHAR2,
    IP_ISINVESTIGATORINITIATED    IN VARCHAR2,
    IP_ISACADEMIC   IN VARCHAR2,
    IP_ISGOVERNMENT    IN VARCHAR2,
    IP_ISOTHERSPONSORTYPES    IN VARCHAR2,
      IP_ISPEDIATRIC    IN VARCHAR2, 
      IP_ISADULT    IN VARCHAR2, 
      IP_ISGERIATRIC    IN VARCHAR2,
      IP_ISHISPANIC     IN VARCHAR2,
      IP_ISAMERICAN     IN VARCHAR2,
      IP_ISASIAN        IN VARCHAR2,
      IP_ISBLACK        IN VARCHAR2,
      IP_ISNATIVE       IN VARCHAR2,
      IP_ISCAUCASIAN    IN VARCHAR2,
      ISWRITTENSOP IN VARCHAR2,
      IP_ISMINORASSENTPEDIATRIC IN VARCHAR2,
      IP_ISOTHERVULNERABLE IN VARCHAR2,
      IP_ISSHORTFORM    IN VARCHAR2,
      IP_AVGDAYS        IN NUM_ARRAY,
      IP_HASLOCAL       IN VARCHAR2,
      IP_HASCENTRALASLOCAL IN VARCHAR2,
      IP_HASSPONSORCENTRAL IN VARCHAR2,
      IP_CENTRIFUGE     IN VARCHAR2,
      IP_REFCENTRIFUGESAMPLES  IN VARCHAR2,
      IP_ISMEDICALEMERGENCIES  IN VARCHAR2,
      IP_OPENWEEKEND    IN VARCHAR2,
      IP_ADMITRESEARCHSUBJECTS  IN VARCHAR2,
      IP_STUDYMATERIAL  IN VARCHAR2,
      IP_PKPDCAPABILITY  IN VARCHAR2,
      IP_ISPGXSAMPLEALLOWED  IN VARCHAR2,
      IP_ISENGKNOWLEDGE  IN VARCHAR2,
      IP_ISTRANSSUPPORT  IN VARCHAR2,
      IP_DEDICATEDCOMPUTER  IN VARCHAR2, 
      IP_CT               IN VARCHAR2,
      IP_DXA              IN VARCHAR2,
      IP_ECG              IN VARCHAR2,
      IP_FLRO             IN VARCHAR2,
      IP_MRI              IN VARCHAR2,
      IP_MRA              IN VARCHAR2,
      IP_MRS              IN VARCHAR2,
      IP_MAMMO            IN VARCHAR2,
      IP_NMED             IN VARCHAR2,
      IP_PET              IN VARCHAR2,
      IP_XRAY             IN VARCHAR2,
      IP_ISRADIOLABLDIPCAPABLE IN VARCHAR2,
      IP_ISINFUSIONCAPABLE IN VARCHAR2,
      IP_ISREGLICPRESENT IN VARCHAR2,
      IP_ISDESTRYIPCPBLCTRLDSUBS IN VARCHAR2,
      IP_ISIPSTORAGESECURED IN VARCHAR2,
      IP_ISDESTROYIPCAPABLE IN VARCHAR2,
      IP_SECURERECORDSTORAGE IN VARCHAR2,
      IP_ONSITEARCHIVING IN VARCHAR2,
      IP_OFFSET         IN NUMBER,
      IP_LIMIT          IN NUMBER,
      IP_ORDRBY         IN VARCHAR2,
      IP_SORTBY         IN VARCHAR2,
      IP_COUNT OUT NUMBER,
      FACSRCH OUT SYS_REFCURSOR)
;

--Procedure for Sponsor User PullCV search
PROCEDURE SP_SPNSR_PULLCV_USR_SEARCH(
      IP_ORGID          IN TBL_ORGANIZATION.ORGID%TYPE,
      IP_FIRSTNAME      IN TBL_USERPROFILES.FIRSTNAME%TYPE,
      IP_LASTNAME       IN TBL_USERPROFILES.LASTNAME%TYPE,
      IP_EMAIL          IN TBL_CONTACT.EMAIL%TYPE,
      IP_COUNTRYCD      IN TBL_CONTACT.COUNTRYCD%TYPE,
      IP_STATECD        IN TBL_CONTACT.STATE%TYPE,
      IP_CITY           IN TBL_CONTACT.CITY%TYPE,
      IP_ROLENAME       IN TBL_ROLES.ROLENAME%TYPE,
      IP_ACTSTARTDATE   IN DATE,
      IP_ACTENDDATE     IN DATE,
      IP_STUDYIDS       IN NUM_ARRAY,
      IP_PROGRAMIDS     IN NUM_ARRAY,
      IP_SPECIALTYIDS   IN NUM_ARRAY,
      IP_STUDYTYPEIDS   IN NUM_ARRAY,
      IP_PHASEIDS       IN NUM_ARRAY,
      IP_THERAPETICID   IN NUMBER,
      IP_SUBTHERAIDS    IN NUM_ARRAY,
      IP_NOOFCOMPLSTUDY IN NUMBER,
      IP_NOOFONGNTUDY   IN NUMBER,
      IP_INST_PROF      IN TBL_PROFEXPERIENCESIP.INSTITUTION%TYPE,
      IP_INST_EDU       IN TBL_USEREDUCATIONSIP.INSTITUTION%TYPE,
      IP_GCPTRAINING    IN VARCHAR2,
      IP_CV_GENERATED   IN VARCHAR2,
      IP_FACILITY_NAME  IN TBL_FACILITIES.FACILITYNAME%TYPE,
      IP_DEPT_TYPE      IN NUM_ARRAY, 
      IP_CVSTARTDATE    IN DATE,
      IP_CVENDDATE      IN DATE,
      IP_OFFSET         IN NUMBER,
      IP_LIMIT          IN NUMBER,
      IP_ORDRBY         IN VARCHAR2,
      IP_SORTBY         IN VARCHAR2,
      
      OP_COUNT OUT NUMBER,
      OP_USRSRCH OUT SYS_REFCURSOR);
  procedure sp_src_usr_studysite(IP_LOGGEDINUSERID IN NUMBER,
                                                   IP_FIRSTNAME      IN VARCHAR2,
                                                   IP_LASTNAME       IN VARCHAR2,
                                                   IP_EMAIL          IN VARCHAR2,
                                                   IP_PHONE          IN NUMBER,
                                                   IP_STATEID        IN NUMBER,
                                                   IP_COUNTRY        IN NUMBER,
                                                   IP_CITY           IN VARCHAR2,
                                                   IP_POSTALCD       IN VARCHAR2,
                                                   IP_STUDYID        IN NUMBER,
                                                   IP_SITEID         IN NUMBER,
                                                   IP_STUDYSIDEROLE  IN NUM_ARRAY,
                                                   IP_TRANSCELERATEID IN VARCHAR2,
                                                   IP_OFFSET         IN NUMBER,
                                                   IP_LIMIT          IN NUMBER,
                                                   IP_ORDRBY         IN VARCHAR2,
                                                   IP_SORTBY         IN VARCHAR2,
                                                   OP_COUNT          OUT NUMBER,
                                                   OP_CURSOR         OUT SYS_REFCURSOR);
												   
PROCEDURE SP_PI_SEARCH(IP_FIRSTNAME   IN VARCHAR2,
IP_LASTNAME                 IN VARCHAR2,
IP_EMAIL                    IN VARCHAR2,
IP_ROLENAME                 IN VARCHAR_ARRAY,
IP_COUNTRYID                IN NUM_ARRAY,
IP_STATE                    IN VARCHAR2, --STATECD
IP_CITY                     IN VARCHAR2,
IP_USERID                   IN NUMBER,
IP_INS_BY_PROF              IN VARCHAR2,
IP_INS_BY_EDU               IN VARCHAR2,
IP_THERAPEAUTICAREAID       IN NUM_ARRAY,
IP_TRAINING_TYPE_ID         IN NUMBER ,
IP_SPONSORTYPEID            IN NUM_ARRAY,
IP_PHASEID                  IN NUM_ARRAY,
IP_SUBTHERAPEUTICAREAID     IN NUM_ARRAY,
IP_NUMCOMPLETEDTRIALS       IN NUMBER,
IP_NUMONGOINGTRIALS         IN NUMBER,
IP_FACILITYNAME             IN VARCHAR2,
IP_DEPARTMENTTYPEID         IN VARCHAR2,
IP_THERAPEUTICAREANAME      IN NUMBER,
IP_SUBTHERAPEUTICAREANAME   IN NUMBER,
IP_PHASENAME                IN VARCHAR2,
IP_ISPEDIATRIC              IN VARCHAR2,
IP_ISGERIATRIC              IN VARCHAR2,
IP_ISADULT                  IN VARCHAR2,
IP_ETHNICITYTITLE           IN VARCHAR_ARRAY,
IP_HASLOCAL                 IN VARCHAR2,
IP_HASCENTRALASLOCAL        IN VARCHAR2,
IP_HASSPONSORCENTRAL        IN VARCHAR2,
IP_AVGSTARTTIME             IN NUM_ARRAY,
IP_ISRADIOLABLDIPCAPABLE    IN VARCHAR2,
IP_ISINFUSIONCAPABLE        IN VARCHAR2,
IP_ISREGULATORYLICENCEPRESENT IN VARCHAR2,
IP_ISGLOVEBOXVENTED           IN VARCHAR2,
IP_ISLAMINARFLOWHOOD          IN VARCHAR2,
IP_ISGLOVEBOXVENTOUT          IN VARCHAR2,
IP_CENTRIFUGE                 IN VARCHAR2,
IP_REFCENTRIFUGESAMPLES       IN VARCHAR2,
IP_ISMEDICALEMERGENCIES       IN VARCHAR2,
IP_ISREFRIGERATOR2TO8         IN VARCHAR2,
IP_ISFREEZER20TO30            IN VARCHAR2,
IP_ISFREEZER70TO80            IN VARCHAR2,
IP_ISFREEZER135               IN VARCHAR2,
IP_CT                         IN VARCHAR2,
IP_DXA                        IN VARCHAR2,
IP_ECG                        IN VARCHAR2,
IP_FLRO                       IN VARCHAR2,
IP_MRA                        IN VARCHAR2,
IP_MRI                        IN VARCHAR2,
IP_MRS                        IN VARCHAR2,
IP_MAMMO                      IN VARCHAR2,
IP_NMED                       IN VARCHAR2,
IP_PET                        IN VARCHAR2,
IP_XRAY                       IN VARCHAR2,
IP_ISMINORASSENTPEDIATRIC     IN VARCHAR2,
IP_ISOTHERVULNERABLE          IN VARCHAR2,
IP_SECURERECORDSTORAGE        IN VARCHAR2,
IP_ONSITEARCHIVING            IN VARCHAR2,
IP_ISIPSTORAGESECURED         IN VARCHAR2,
IP_OPENWEEKEND                IN VARCHAR2,
IP_ADMITRESEARCHSUBJECTS      IN VARCHAR2,
IP_STUDYMATERIAL              IN VARCHAR2,
IP_PKPDCAPABILITY             IN VARCHAR2,
IP_ISPGXSAMPLEALLOWED         IN VARCHAR2,
IP_ISENGKNOWLEDGE             IN VARCHAR2,
IP_ISTRANSSUPPORT             IN VARCHAR2,
IP_DEDICATEDCOMPUTER          IN VARCHAR2,
IP_ISINDUSTRY                 IN VARCHAR2,
IP_ISINVESTIGATORINITIATED    IN VARCHAR2,
IP_ISACADEMIC                 IN VARCHAR2,
IP_ISGOVERNMENT               IN VARCHAR2,
IP_ISOTHERSPONSORTYPES        IN VARCHAR2,
IP_ISFORUSER_FACILITY         IN VARCHAR2,
IP_RESEARCHTHERAPEUTICID      IN NUMBER,
IP_FACILITYCOUNTRYID          IN NUMBER,
IP_FACILITYSTATE              IN VARCHAR2,
IP_FACILITYCITY               IN VARCHAR2,
IP_ISEXEPREPARATION           IN VARCHAR2,
IP_ISFLOWHOOD                 IN VARCHAR2,
IP_ISINFORMCONSENT            IN VARCHAR2,
IP_ISSHORTFORM                IN VARCHAR2,
IP_ISDESTROYIPCAPABLE         IN VARCHAR2,
IP_ISDSTRYIPCPBLECONTRLDSUBS  IN VARCHAR2,
IP_getIsGcpTrainingCompleted  IN VARCHAR2,
IP_OFFSET                     IN NUMBER,
IP_LIMIT                      IN NUMBER,
IP_ORDRBY                     IN VARCHAR2,
IP_SORTBY                     IN VARCHAR2,
OP_COUNT                    OUT NUMBER,
OP_PI_RESULT                OUT SYS_REFCURSOR);

PROCEDURE SP_USER_DETAILS_SEARCH( IP_TRANSCELERATEID  IN VARCHAR2,
                                  IP_OFFSET           IN NUMBER,
                                  IP_LIMIT            IN NUMBER,
                                  IP_COUNT            OUT NUMBER,
                                  OP_USERDETAILS OUT SYS_REFCURSOR);
PROCEDURE SP_FAC_DETAILS_SEARCH( IP_TRANSCELERATEID  IN VARCHAR2,
                                 IP_FACILITYID       IN NUMBER,
                                 IP_OFFSET           IN NUMBER,
                                 IP_LIMIT            IN NUMBER,
                                 IP_COUNT            OUT NUMBER,
                                 OP_FACIDETAILS OUT SYS_REFCURSOR);

/******************************************************************************
  Object_name - SP_GET_DOCDETAILS
  Purpose - Procedure to fetch document details
  *******************************************************************************/
PROCEDURE SP_GET_DOCDETAILS
(
I_DOCID         IN NUMBER,
I_USERID        IN NUMBER,
I_ORGID         IN NUMBER,
IP_SEARCH_TYPE  IN VARCHAR2,
REF_CUS_USERS   OUT SYS_REFCURSOR
);

--Function to Replace Special Characters in Wild Card Search
FUNCTION FN_REPLACE_WILDSPLCHAR
(ip_input_string IN VARCHAR2) RETURN VARCHAR2;

END PKG_SEARCH;
/